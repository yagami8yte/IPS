<UserControl x:Class="IPS.MainApp.Views.SalesContentView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:IPS.MainApp.ViewModels"
             xmlns:oxy="http://oxyplot.org/wpf"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance vm:SalesViewModel}"
             d:DesignHeight="1600" d:DesignWidth="1000">
    <Grid>
        <StackPanel Margin="0">
        <!-- Time Period Selector -->
        <Border Background="White"
                CornerRadius="8"
                Padding="30"
                Margin="0,0,0,20">
            <StackPanel>
                <TextBlock Text="ðŸ“Š Sales Dashboard"
                           FontSize="28"
                           FontWeight="Bold"
                           Foreground="{StaticResource DarkBrown}"
                           Margin="0,0,0,20"/>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                               Text="Time Period:"
                               FontSize="20"
                               VerticalAlignment="Center"
                               Foreground="{StaticResource DarkBrown}"
                               Margin="0,0,20,0"/>

                    <ComboBox Grid.Column="1"
                              ItemsSource="{Binding TimeIntervals}"
                              SelectedValue="{Binding SelectedTimeInterval}"
                              SelectedValuePath="Interval"
                              DisplayMemberPath="DisplayName"
                              FontSize="18"
                              Padding="10"
                              MaxWidth="300"
                              HorizontalAlignment="Left"
                              Background="White"
                              BorderBrush="{StaticResource DarkBrown}"
                              BorderThickness="2"/>

                    <Button Grid.Column="2"
                            Content="Export Data"
                            Command="{Binding ExportDataCommand}"
                            FontSize="18"
                            Padding="20,8"
                            Background="{StaticResource AccentGreen}"
                            Foreground="White"
                            BorderBrush="{StaticResource DarkBrown}"
                            BorderThickness="2"
                            Cursor="Hand">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="6"/>
                            </Style>
                        </Button.Resources>
                    </Button>
                </Grid>

                <!-- Custom Date Range Selector -->
                <Border Visibility="{Binding IsCustomRangeVisible, Converter={StaticResource BooleanToVisibilityConverter}}"
                        Background="{StaticResource LightCream}"
                        BorderBrush="{StaticResource SageGreen}"
                        BorderThickness="2"
                        CornerRadius="8"
                        Padding="20"
                        Margin="0,20,0,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Start Date -->
                        <TextBlock Grid.Column="0"
                                   Text="From:"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource DarkBrown}"
                                   Margin="0,0,10,0"/>

                        <DatePicker Grid.Column="1"
                                    SelectedDate="{Binding CustomStartDate, Mode=TwoWay}"
                                    FontSize="16"
                                    Padding="10"
                                    BorderBrush="{StaticResource DarkBrown}"
                                    BorderThickness="2"
                                    Width="180"/>

                        <!-- End Date -->
                        <TextBlock Grid.Column="3"
                                   Text="To:"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource DarkBrown}"
                                   Margin="0,0,10,0"/>

                        <DatePicker Grid.Column="4"
                                    SelectedDate="{Binding CustomEndDate, Mode=TwoWay}"
                                    FontSize="16"
                                    Padding="10"
                                    BorderBrush="{StaticResource DarkBrown}"
                                    BorderThickness="2"
                                    Width="180"/>

                        <!-- Apply Button -->
                        <Button Grid.Column="6"
                                Content="ðŸ“Š Apply"
                                Command="{Binding ApplyCustomRangeCommand}"
                                FontSize="18"
                                FontWeight="SemiBold"
                                Padding="30,8"
                                Background="{StaticResource PrimaryBrown}"
                                Foreground="White"
                                BorderBrush="{StaticResource DarkBrown}"
                                BorderThickness="2"
                                Cursor="Hand">
                            <Button.Resources>
                                <Style TargetType="Border">
                                    <Setter Property="CornerRadius" Value="6"/>
                                </Style>
                            </Button.Resources>
                        </Button>
                    </Grid>
                </Border>
            </StackPanel>
        </Border>

        <!-- Summary Cards -->
        <Grid Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="10"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="10"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Total Revenue Card -->
            <Border Grid.Column="0"
                    Background="#E8F0E7"
                    BorderBrush="{StaticResource SageGreen}"
                    BorderThickness="3"
                    CornerRadius="8"
                    Padding="20">
                <StackPanel>
                    <TextBlock Text="Total Revenue"
                               FontSize="16"
                               Foreground="{StaticResource Espresso}"
                               Margin="0,0,0,5"/>
                    <TextBlock FontSize="36"
                               FontWeight="Bold"
                               Foreground="{StaticResource SageGreen}">
                        <Run Text="$"/>
                        <Run Text="{Binding TotalRevenue, StringFormat=F2}"/>
                    </TextBlock>
                </StackPanel>
            </Border>

            <!-- Total Orders Card -->
            <Border Grid.Column="2"
                    Background="{StaticResource LightCream}"
                    BorderBrush="{StaticResource MetallicGold}"
                    BorderThickness="3"
                    CornerRadius="8"
                    Padding="20">
                <StackPanel>
                    <TextBlock Text="Total Orders"
                               FontSize="16"
                               Foreground="{StaticResource Espresso}"
                               Margin="0,0,0,5"/>
                    <TextBlock Text="{Binding TotalOrders}"
                               FontSize="36"
                               FontWeight="Bold"
                               Foreground="{StaticResource ForestGreen}"/>
                </StackPanel>
            </Border>

            <!-- Average Order Value Card -->
            <Border Grid.Column="4"
                    Background="#F5EFDF"
                    BorderBrush="{StaticResource MetallicGold}"
                    BorderThickness="3"
                    CornerRadius="8"
                    Padding="20">
                <StackPanel>
                    <TextBlock Text="Avg. Order Value"
                               FontSize="16"
                               Foreground="{StaticResource Espresso}"
                               Margin="0,0,0,5"/>
                    <TextBlock FontSize="36"
                               FontWeight="Bold"
                               Foreground="{StaticResource MetallicGold}">
                        <Run Text="$"/>
                        <Run Text="{Binding AverageOrderValue, StringFormat=F2}"/>
                    </TextBlock>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Revenue Chart -->
        <Border Background="White"
                CornerRadius="8"
                Padding="30"
                Margin="0,0,0,20">
            <StackPanel>
                <TextBlock Text="Revenue Trend"
                           FontSize="24"
                           FontWeight="Bold"
                           Foreground="{StaticResource DarkBrown}"
                           Margin="0,0,0,15"/>

                <oxy:PlotView Model="{Binding RevenuePlotModel}"
                             Height="300"
                             Background="White"/>
            </StackPanel>
        </Border>

        <!-- Top Selling Items -->
        <Border Background="White"
                CornerRadius="8"
                Padding="30"
                Margin="0,0,0,20">
            <StackPanel>
                <TextBlock Text="Top Selling Items"
                           FontSize="24"
                           FontWeight="Bold"
                           Foreground="{StaticResource DarkBrown}"
                           Margin="0,0,0,15"/>

                <DataGrid ItemsSource="{Binding TopItems}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          HeadersVisibility="Column"
                          GridLinesVisibility="None"
                          Background="White"
                          BorderThickness="0"
                          RowBackground="White"
                          AlternatingRowBackground="{StaticResource BackgroundBeige}"
                          FontSize="16"
                          LoadingRow="TopItemsDataGrid_LoadingRow">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Rank"
                                          Binding="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Path=Header}"
                                          Width="60"/>
                        <DataGridTextColumn Header="Item Name"
                                          Binding="{Binding ItemName}"
                                          Width="*"/>
                        <DataGridTextColumn Header="System"
                                          Binding="{Binding SystemName}"
                                          Width="120"/>
                        <DataGridTextColumn Header="Qty Sold"
                                          Binding="{Binding QuantitySold}"
                                          Width="100"/>
                        <DataGridTextColumn Header="Revenue"
                                          Binding="{Binding TotalRevenue, StringFormat=\{0:C2\}}"
                                          Width="120"/>
                        <DataGridTextColumn Header="% of Sales"
                                          Binding="{Binding Percentage, StringFormat=\{0:F1\}%}"
                                          Width="100"/>
                    </DataGrid.Columns>
                    <DataGrid.RowHeaderTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Path=Header}"
                                     FontWeight="Bold"
                                     Margin="5,0"/>
                        </DataTemplate>
                    </DataGrid.RowHeaderTemplate>
                </DataGrid>
            </StackPanel>
        </Border>

        <!-- Order History -->
        <Border Background="White"
                CornerRadius="8"
                Padding="30"
                Margin="0,0,0,0">
            <StackPanel>
                <TextBlock Text="Order History"
                           FontSize="24"
                           FontWeight="Bold"
                           Foreground="{StaticResource DarkBrown}"
                           Margin="0,0,0,15"/>

                <DataGrid ItemsSource="{Binding OrderHistory}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          HeadersVisibility="Column"
                          GridLinesVisibility="None"
                          Background="White"
                          BorderThickness="0"
                          RowBackground="White"
                          AlternatingRowBackground="{StaticResource BackgroundBeige}"
                          FontSize="14"
                          MaxHeight="400">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Order #"
                                          Binding="{Binding OrderLabel}"
                                          Width="80"/>
                        <DataGridTextColumn Header="Date &amp; Time"
                                          Binding="{Binding OrderDateTime, StringFormat=\{0:yyyy-MM-dd HH:mm\}}"
                                          Width="150"/>
                        <DataGridTextColumn Header="Total"
                                          Binding="{Binding TotalAmount, StringFormat=\{0:C2\}}"
                                          Width="100"/>
                        <DataGridTextColumn Header="Payment"
                                          Binding="{Binding PaymentMethod}"
                                          Width="100"/>
                        <DataGridTextColumn Header="Status"
                                          Binding="{Binding Status}"
                                          Width="100"/>
                        <DataGridTextColumn Header="Items"
                                          Binding="{Binding Items.Count}"
                                          Width="80"/>
                    </DataGrid.Columns>
                </DataGrid>
            </StackPanel>
        </Border>
        </StackPanel>

        <!-- Loading Overlay (only shown during data refresh) -->
        <Border Background="#CC442B2D"
                Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                CornerRadius="8">
            <Grid VerticalAlignment="Center" HorizontalAlignment="Center">
                <StackPanel Orientation="Vertical"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center">
                    <!-- Spinning Progress Ring -->
                    <Grid Width="120" Height="120" Margin="0,0,0,20">
                        <Ellipse Stroke="{StaticResource AccentLatte}"
                                StrokeThickness="8"
                                Width="120"
                                Height="120"
                                StrokeDashArray="70 30"
                                Opacity="0.9">
                            <Ellipse.RenderTransform>
                                <RotateTransform x:Name="SpinnerRotate" CenterX="60" CenterY="60"/>
                            </Ellipse.RenderTransform>
                            <Ellipse.Triggers>
                                <EventTrigger RoutedEvent="Loaded">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="SpinnerRotate"
                                                           Storyboard.TargetProperty="Angle"
                                                           From="0"
                                                           To="360"
                                                           Duration="0:0:1.5"
                                                           RepeatBehavior="Forever"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </Ellipse.Triggers>
                        </Ellipse>
                    </Grid>

                    <!-- Loading Text -->
                    <TextBlock Text="Loading Sales Data..."
                              FontSize="28"
                              FontFamily="{StaticResource BrandFont}"
                              FontWeight="SemiBold"
                              Foreground="{StaticResource LightCream}"
                              HorizontalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>

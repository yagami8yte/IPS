<UserControl x:Class="IPS.MainApp.Views.AdminView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:IPS.MainApp.Views"
             xmlns:vm="clr-namespace:IPS.MainApp.ViewModels"
             xmlns:controls="clr-namespace:IPS.MainApp.Views.Controls"
             xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
             mc:Ignorable="d"
             d:DesignHeight="1920" d:DesignWidth="1080"
             d:DataContext="{d:DesignInstance Type=vm:AdminViewModel}">
    <Grid Background="{StaticResource LightCream}">
        <Grid.RowDefinitions>
            <RowDefinition Height="150"/> <!-- Header -->
            <RowDefinition Height="Auto"/> <!-- Section Selector -->
            <RowDefinition Height="*"/> <!-- Content -->
            <RowDefinition Height="120"/> <!-- Action buttons -->
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{StaticResource DarkBrown}">
            <TextBlock Text="System Configuration"
                       FontSize="48"
                       FontWeight="Bold"
                       Foreground="{StaticResource LightCream}"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"/>
        </Border>

        <!-- Configuration Section Selector (Horizontal) -->
        <Border Grid.Row="1"
                Background="{StaticResource DarkBrown}"
                BorderBrush="{StaticResource AccentGold}"
                BorderThickness="0,2,0,2"
                Padding="15,12">
            <ItemsControl ItemsSource="{Binding ConfigSections}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="{StaticResource AccentLatte}"
                                BorderThickness="2"
                                Padding="28,12"
                                Margin="8,0"
                                CornerRadius="18"
                                Cursor="Hand">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                            <Setter Property="Background" Value="{StaticResource AccentLatte}"/>
                                            <Setter Property="BorderBrush" Value="{StaticResource AccentGold}"/>
                                            <Setter Property="BorderThickness" Value="3"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <Border.InputBindings>
                                <MouseBinding Command="{Binding Path=DataContext.SelectSectionCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                              CommandParameter="{Binding SectionId}"
                                              MouseAction="LeftClick"/>
                            </Border.InputBindings>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding Icon}"
                                           FontSize="28"
                                           Margin="0,0,8,0"
                                           VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding DisplayName}"
                                           FontSize="28"
                                           FontFamily="{StaticResource BrandFont}"
                                           FontWeight="SemiBold"
                                           VerticalAlignment="Center">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="{StaticResource LightCream}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                    <Setter Property="Foreground" Value="{StaticResource DarkBrown}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Border>

        <!-- Content -->
        <ScrollViewer Grid.Row="2"
                      VerticalScrollBarVisibility="Auto"
                      PanningMode="VerticalOnly"
                      PanningDeceleration="0.001"
                      PanningRatio="1">
            <StackPanel Margin="40">

                <!-- Systems Section (Network Scanner + Unmanned Systems) -->
                <StackPanel Visibility="{Binding IsSystemsSectionVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                <!-- Network Scanner Section -->
                <Border Background="White"
                        CornerRadius="8"
                        Padding="30"
                        Margin="0,0,0,20">
                    <StackPanel>
                        <Grid Margin="0,0,0,20">
                            <TextBlock Text="ðŸ” Network Device Scanner"
                                       FontSize="28"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource DarkBrown}"
                                       HorizontalAlignment="Left"/>

                            <Button Content="Scan Network"
                                    Command="{Binding ScanNetworkCommand}"
                                    HorizontalAlignment="Right"
                                    FontSize="22"
                                    Padding="30,10"
                                    Background="{StaticResource AccentGreen}"
                                    Foreground="White"
                                    BorderBrush="{StaticResource DarkBrown}"
                                    BorderThickness="2"
                                    Cursor="Hand">
                                <Button.Resources>
                                    <Style TargetType="Border">
                                        <Setter Property="CornerRadius" Value="8"/>
                                    </Style>
                                </Button.Resources>
                            </Button>
                        </Grid>

                        <!-- Scan Status -->
                        <StackPanel Visibility="{Binding IsScanning, Converter={StaticResource BooleanToVisibilityConverter}}"
                                    Margin="0,0,0,15">
                            <TextBlock Text="{Binding ScanStatus}"
                                       FontSize="18"
                                       Foreground="{StaticResource PrimaryBrown}"
                                       Margin="0,0,0,10"/>
                            <ProgressBar Value="{Binding ScanProgress}"
                                         Height="8"
                                         Minimum="0"
                                         Maximum="100"
                                         Foreground="{StaticResource AccentGreen}"/>
                        </StackPanel>

                        <!-- Discovered Devices List -->
                        <ItemsControl ItemsSource="{Binding DiscoveredDevices}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#E8F0E7"
                                            CornerRadius="6"
                                            Padding="15"
                                            Margin="0,0,0,10">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0">
                                                <TextBlock FontSize="18"
                                                           FontWeight="Bold"
                                                           Foreground="{StaticResource DarkBrown}">
                                                    <Run Text="{Binding DeviceType}"/>
                                                    <Run Text=" - "/>
                                                    <Run Text="{Binding IpAddress}"/>
                                                    <Run Text=":"/>
                                                    <Run Text="{Binding Port}"/>
                                                </TextBlock>
                                            </StackPanel>

                                            <Button Grid.Column="1"
                                                    Content="+ Add to Config"
                                                    Command="{Binding DataContext.AddDiscoveredDeviceCommand, RelativeSource={RelativeSource AncestorType=ScrollViewer}}"
                                                    CommandParameter="{Binding}"
                                                    FontSize="16"
                                                    Padding="15,5"
                                                    Background="{StaticResource AccentGold}"
                                                    Foreground="{StaticResource DarkBrown}"
                                                    BorderThickness="0"
                                                    Cursor="Hand">
                                                <Button.Resources>
                                                    <Style TargetType="Border">
                                                        <Setter Property="CornerRadius" Value="5"/>
                                                    </Style>
                                                </Button.Resources>
                                            </Button>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- Receipt Printer Scanner (part of Systems section) -->
                <Border Background="White"
                        CornerRadius="8"
                        Padding="30"
                        Margin="0,0,0,20">
                    <StackPanel>
                        <Grid Margin="0,0,0,20">
                            <TextBlock Text="ðŸ–¨ï¸ Receipt Printer Scanner"
                                       FontSize="28"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource DarkBrown}"
                                       HorizontalAlignment="Left"/>

                            <Button Content="Scan Printers"
                                    Command="{Binding ScanPrintersCommand}"
                                    HorizontalAlignment="Right"
                                    FontSize="22"
                                    Padding="30,10"
                                    Background="{StaticResource AccentGreen}"
                                    Foreground="White"
                                    BorderBrush="{StaticResource DarkBrown}"
                                    BorderThickness="2"
                                    Cursor="Hand">
                                <Button.Resources>
                                    <Style TargetType="Border">
                                        <Setter Property="CornerRadius" Value="8"/>
                                    </Style>
                                </Button.Resources>
                            </Button>
                        </Grid>

                        <!-- Scan Status -->
                        <StackPanel Visibility="{Binding IsPrinterScanning, Converter={StaticResource BooleanToVisibilityConverter}}"
                                    Margin="0,0,0,15">
                            <TextBlock Text="{Binding PrinterScanStatus}"
                                       FontSize="18"
                                       Foreground="{StaticResource PrimaryBrown}"
                                       Margin="0,0,0,10"/>
                            <ProgressBar Value="{Binding PrinterScanProgress}"
                                         Height="8"
                                         Minimum="0"
                                         Maximum="100"
                                         Foreground="{StaticResource AccentGreen}"/>
                        </StackPanel>

                        <!-- Discovered Printers List -->
                        <ItemsControl ItemsSource="{Binding AvailablePrinters}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border BorderBrush="{StaticResource AccentLatte}"
                                            BorderThickness="2"
                                            CornerRadius="8"
                                            Padding="15"
                                            Margin="0,0,0,10"
                                            Background="{StaticResource BackgroundBeige}"
                                            Cursor="Hand">
                                        <Border.InputBindings>
                                            <MouseBinding Command="{Binding DataContext.SelectReceiptPrinterCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                          CommandParameter="{Binding PrinterName}"
                                                          MouseAction="LeftClick"/>
                                        </Border.InputBindings>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <StackPanel Grid.Column="0">
                                                <TextBlock Text="{Binding PrinterName}"
                                                           FontSize="20"
                                                           FontWeight="SemiBold"
                                                           Foreground="{StaticResource DarkBrown}"/>
                                                <StackPanel Orientation="Horizontal"
                                                            Margin="0,5,0,0">
                                                    <TextBlock FontSize="16"
                                                               Foreground="{StaticResource PrimaryBrown}">
                                                        <Run Text="Type:"/>
                                                        <Run Text="{Binding PrinterType}"/>
                                                        <Run Text=" | Port:"/>
                                                        <Run Text="{Binding PortName}"/>
                                                    </TextBlock>
                                                    <TextBlock Text="[DEFAULT]"
                                                               FontSize="16"
                                                               FontWeight="Bold"
                                                               Foreground="{StaticResource AccentGold}"
                                                               Margin="10,0,0,0"
                                                               Visibility="{Binding IsDefault, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                                </StackPanel>
                                            </StackPanel>

                                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                                <!-- Test Print Button -->
                                                <Button Content="Test Print"
                                                        Command="{Binding DataContext.TestPrinterCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                        CommandParameter="{Binding}"
                                                        FontSize="18"
                                                        Padding="20,8"
                                                        Background="{StaticResource AccentGold}"
                                                        Foreground="{StaticResource DarkBrown}"
                                                        BorderThickness="0"
                                                        Margin="0,0,10,0"
                                                        Cursor="Hand">
                                                    <Button.Resources>
                                                        <Style TargetType="Border">
                                                            <Setter Property="CornerRadius" Value="6"/>
                                                        </Style>
                                                    </Button.Resources>
                                                </Button>

                                                <!-- Selection indicator (checkmark) -->
                                                <TextBlock Text="âœ“"
                                                           FontSize="28"
                                                           FontWeight="Bold"
                                                           Foreground="{StaticResource AccentGreen}"
                                                           VerticalAlignment="Center">
                                                    <TextBlock.Visibility>
                                                        <MultiBinding Converter="{StaticResource StringEqualityConverter}">
                                                            <Binding Path="PrinterName"/>
                                                            <Binding Path="DataContext.SelectedReceiptPrinter" RelativeSource="{RelativeSource AncestorType=UserControl}"/>
                                                        </MultiBinding>
                                                    </TextBlock.Visibility>
                                                </TextBlock>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- Auto-print Receipt Checkbox -->
                        <CheckBox IsChecked="{Binding AutoPrintReceipt}"
                                  FontSize="22"
                                  Foreground="{StaticResource Espresso}"
                                  FontFamily="{StaticResource BrandFont}"
                                  Margin="0,20,0,0">
                            <TextBlock Text="Automatically print receipt after successful payment"
                                       FontSize="22"
                                       Foreground="{StaticResource Espresso}"
                                       TextWrapping="Wrap"/>
                        </CheckBox>
                    </StackPanel>
                </Border>

                <!-- DLL Server Port (part of Systems section) -->
                <Border Background="White"
                        CornerRadius="8"
                        Padding="30"
                        Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="DLL Server Configuration"
                                   FontSize="28"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource DarkBrown}"
                                   Margin="0,0,0,20"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="200"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0"
                                       Text="Server Port:"
                                       FontSize="22"
                                       VerticalAlignment="Center"
                                       Foreground="{StaticResource DarkBrown}"/>

                            <TextBox Grid.Column="1"
                                     Text="{Binding DllServerPort, Mode=TwoWay}"
                                     FontSize="22"
                                     Padding="10"
                                     VerticalAlignment="Center"
                                     Background="{StaticResource BackgroundBeige}"
                                     BorderBrush="{StaticResource DarkBrown}"
                                     BorderThickness="2"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Unmanned Systems Configuration (part of Systems section) -->
                <Border Background="White"
                        CornerRadius="8"
                        Padding="30"
                        Margin="0,0,0,20">
                    <StackPanel>
                        <Grid Margin="0,0,0,20">
                            <TextBlock Text="Unmanned Systems"
                                       FontSize="28"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource DarkBrown}"
                                       HorizontalAlignment="Left"
                                       VerticalAlignment="Center"/>

                            <Button Content="+ Add System"
                                    Command="{Binding AddSystemCommand}"
                                    HorizontalAlignment="Right"
                                    FontSize="22"
                                    Padding="30,10"
                                    Background="{StaticResource AccentGold}"
                                    Foreground="{StaticResource DarkBrown}"
                                    BorderBrush="{StaticResource DarkBrown}"
                                    BorderThickness="2"
                                    Cursor="Hand">
                                <Button.Resources>
                                    <Style TargetType="Border">
                                        <Setter Property="CornerRadius" Value="8"/>
                                    </Style>
                                </Button.Resources>
                            </Button>
                        </Grid>

                        <!-- System List -->
                        <ItemsControl ItemsSource="{Binding Systems}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{StaticResource BackgroundBeige}"
                                            CornerRadius="8"
                                            Padding="20"
                                            Margin="0,0,0,15"
                                            BorderBrush="{StaticResource DarkBrown}"
                                            BorderThickness="1">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="200"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- System Name -->
                                            <TextBlock Grid.Row="0" Grid.Column="0"
                                                       Text="System Name:"
                                                       FontSize="20"
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,0,10"
                                                       Foreground="{StaticResource DarkBrown}"/>
                                            <TextBox Grid.Row="0" Grid.Column="1"
                                                     Text="{Binding SystemName, Mode=TwoWay}"
                                                     FontSize="20"
                                                     Padding="8"
                                                     Margin="0,0,10,10"
                                                     Background="White"
                                                     BorderBrush="{StaticResource DarkBrown}"
                                                     BorderThickness="1"/>

                                            <!-- IP Address -->
                                            <TextBlock Grid.Row="1" Grid.Column="0"
                                                       Text="IP Address:"
                                                       FontSize="20"
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,0,10"
                                                       Foreground="{StaticResource DarkBrown}"/>
                                            <TextBox Grid.Row="1" Grid.Column="1"
                                                     Text="{Binding IpAddress, Mode=TwoWay}"
                                                     FontSize="20"
                                                     Padding="8"
                                                     Margin="0,0,10,10"
                                                     Background="White"
                                                     BorderBrush="{StaticResource DarkBrown}"
                                                     BorderThickness="1"/>

                                            <!-- Port -->
                                            <TextBlock Grid.Row="2" Grid.Column="0"
                                                       Text="Port:"
                                                       FontSize="20"
                                                       VerticalAlignment="Center"
                                                       Foreground="{StaticResource DarkBrown}"/>
                                            <TextBox Grid.Row="2" Grid.Column="1"
                                                     Text="{Binding Port, Mode=TwoWay}"
                                                     FontSize="20"
                                                     Padding="8"
                                                     Margin="0,0,10,0"
                                                     Background="White"
                                                     BorderBrush="{StaticResource DarkBrown}"
                                                     BorderThickness="1"/>

                                            <!-- Remove Button & Enabled Checkbox -->
                                            <StackPanel Grid.Row="0" Grid.Column="2" Grid.RowSpan="3"
                                                        VerticalAlignment="Center">
                                                <CheckBox IsChecked="{Binding IsEnabled, Mode=TwoWay}"
                                                          Content="Enabled"
                                                          FontSize="20"
                                                          Foreground="{StaticResource DarkBrown}"
                                                          VerticalAlignment="Center"
                                                          Margin="0,0,0,10"/>

                                                <Button Content="âœ• Remove"
                                                        Command="{Binding DataContext.RemoveSystemCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                        CommandParameter="{Binding}"
                                                        FontSize="20"
                                                        Padding="20,8"
                                                        Background="{StaticResource ErrorRed}"
                                                        Foreground="White"
                                                        BorderBrush="{StaticResource ErrorRed}"
                                                        BorderThickness="2"
                                                        Cursor="Hand">
                                                    <Button.Resources>
                                                        <Style TargetType="Border">
                                                            <Setter Property="CornerRadius" Value="6"/>
                                                        </Style>
                                                    </Button.Resources>
                                                </Button>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- Business Information Section (Receipt Settings) -->
                <Border Background="White"
                        CornerRadius="8"
                        Padding="30"
                        Margin="0,0,0,20">
                    <StackPanel>
                        <Grid Margin="0,0,0,20">
                            <TextBlock Text="ðŸ§¾ Receipt Settings"
                                       FontSize="28"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource DarkBrown}"
                                       HorizontalAlignment="Left"/>

                            <!-- Fetch from Forte Button -->
                            <Button Command="{Binding FetchFromForteCommand}"
                                    HorizontalAlignment="Right"
                                    FontSize="20"
                                    Padding="25,10"
                                    Background="{StaticResource AccentGreen}"
                                    Foreground="White"
                                    BorderBrush="{StaticResource DarkBrown}"
                                    BorderThickness="2"
                                    Cursor="Hand">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ“¥ " FontSize="20" Margin="0,0,8,0"/>
                                    <TextBlock Text="Fetch from Forte" FontSize="20"/>
                                </StackPanel>
                                <Button.Resources>
                                    <Style TargetType="Border">
                                        <Setter Property="CornerRadius" Value="8"/>
                                    </Style>
                                </Button.Resources>
                            </Button>
                        </Grid>

                        <!-- Fetch Status -->
                        <TextBlock Text="{Binding ForteStoreInfoStatus}"
                                   FontSize="18"
                                   Foreground="{StaticResource PrimaryBrown}"
                                   Margin="0,0,0,15"
                                   Visibility="{Binding ForteStoreInfoStatus, Converter={StaticResource StringToVisibilityConverter}}"/>

                        <!-- Business Name -->
                        <TextBlock Text="Business Name *"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource DarkBrown}"
                                   Margin="0,0,0,8"/>
                        <Border Background="{StaticResource BackgroundBeige}"
                                BorderBrush="{StaticResource DarkBrown}"
                                BorderThickness="2"
                                CornerRadius="8"
                                Padding="15"
                                Margin="0,0,0,20">
                            <TextBox Text="{Binding BusinessName, UpdateSourceTrigger=PropertyChanged}"
                                     FontSize="22"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     Foreground="{StaticResource Espresso}"
                                     FontFamily="{StaticResource BrandFont}"/>
                        </Border>

                        <!-- Address Line 1 -->
                        <TextBlock Text="Address Line 1 (Street)"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource DarkBrown}"
                                   Margin="0,0,0,8"/>
                        <Border Background="{StaticResource BackgroundBeige}"
                                BorderBrush="{StaticResource DarkBrown}"
                                BorderThickness="2"
                                CornerRadius="8"
                                Padding="15"
                                Margin="0,0,0,20">
                            <TextBox Text="{Binding BusinessAddressLine1, UpdateSourceTrigger=PropertyChanged}"
                                     FontSize="22"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     Foreground="{StaticResource Espresso}"
                                     FontFamily="{StaticResource BrandFont}"/>
                        </Border>

                        <!-- Address Line 2 -->
                        <TextBlock Text="Address Line 2 (City, State ZIP)"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource DarkBrown}"
                                   Margin="0,0,0,8"/>
                        <Border Background="{StaticResource BackgroundBeige}"
                                BorderBrush="{StaticResource DarkBrown}"
                                BorderThickness="2"
                                CornerRadius="8"
                                Padding="15"
                                Margin="0,0,0,20">
                            <TextBox Text="{Binding BusinessAddressLine2, UpdateSourceTrigger=PropertyChanged}"
                                     FontSize="22"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     Foreground="{StaticResource Espresso}"
                                     FontFamily="{StaticResource BrandFont}"/>
                        </Border>

                        <!-- Phone Number -->
                        <TextBlock Text="Phone Number"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource DarkBrown}"
                                   Margin="0,0,0,8"/>
                        <Border Background="{StaticResource BackgroundBeige}"
                                BorderBrush="{StaticResource DarkBrown}"
                                BorderThickness="2"
                                CornerRadius="8"
                                Padding="15"
                                Margin="0,0,0,20">
                            <TextBox Text="{Binding BusinessPhone, UpdateSourceTrigger=PropertyChanged}"
                                     FontSize="22"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     Foreground="{StaticResource Espresso}"
                                     FontFamily="{StaticResource BrandFont}"/>
                        </Border>

                        <!-- Tax ID (Optional) -->
                        <TextBlock Text="Tax ID / EIN (Optional)"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource DarkBrown}"
                                   Margin="0,0,0,8"/>
                        <Border Background="{StaticResource BackgroundBeige}"
                                BorderBrush="{StaticResource DarkBrown}"
                                BorderThickness="2"
                                CornerRadius="8"
                                Padding="15"
                                Margin="0,0,0,20">
                            <TextBox Text="{Binding BusinessTaxId, UpdateSourceTrigger=PropertyChanged}"
                                     FontSize="22"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     Foreground="{StaticResource Espresso}"
                                     FontFamily="{StaticResource BrandFont}"/>
                        </Border>

                        <!-- Receipt Footer Message -->
                        <TextBlock Text="Receipt Footer Message"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource DarkBrown}"
                                   Margin="0,0,0,8"/>
                        <Border Background="{StaticResource BackgroundBeige}"
                                BorderBrush="{StaticResource DarkBrown}"
                                BorderThickness="2"
                                CornerRadius="8"
                                Padding="15"
                                Margin="0,0,0,20">
                            <TextBox Text="{Binding ReceiptFooterMessage, UpdateSourceTrigger=PropertyChanged}"
                                     FontSize="22"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     Foreground="{StaticResource Espresso}"
                                     FontFamily="{StaticResource BrandFont}"/>
                        </Border>
                    </StackPanel>
                </Border>

                <!-- Tax Settings Section -->
                <Border Background="White"
                        CornerRadius="8"
                        Padding="30"
                        Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="ðŸ’° Tax Settings"
                                   FontSize="28"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource DarkBrown}"
                                   Margin="0,0,0,20"/>

                        <!-- Enable Tax Checkbox -->
                        <CheckBox IsChecked="{Binding TaxEnabled}"
                                  FontSize="22"
                                  Foreground="{StaticResource Espresso}"
                                  FontFamily="{StaticResource BrandFont}"
                                  Margin="0,0,0,20">
                            <TextBlock Text="Enable tax calculation on orders"
                                       FontSize="22"
                                       Foreground="{StaticResource Espresso}"/>
                        </CheckBox>

                        <!-- Tax Rate -->
                        <TextBlock Text="Tax Rate (%)"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource DarkBrown}"
                                   Margin="0,0,0,8"/>
                        <Border Background="{StaticResource BackgroundBeige}"
                                BorderBrush="{StaticResource DarkBrown}"
                                BorderThickness="2"
                                CornerRadius="8"
                                Padding="15"
                                Margin="0,0,0,20">
                            <TextBox Text="{Binding TaxRateDisplay, UpdateSourceTrigger=PropertyChanged}"
                                     FontSize="22"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     Foreground="{StaticResource Espresso}"
                                     FontFamily="{StaticResource BrandFont}"/>
                        </Border>

                        <!-- Tax Label -->
                        <TextBlock Text="Tax Label (e.g., 'Sales Tax', 'VAT')"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource DarkBrown}"
                                   Margin="0,0,0,8"/>
                        <Border Background="{StaticResource BackgroundBeige}"
                                BorderBrush="{StaticResource DarkBrown}"
                                BorderThickness="2"
                                CornerRadius="8"
                                Padding="15"
                                Margin="0,0,0,20">
                            <TextBox Text="{Binding TaxLabel, UpdateSourceTrigger=PropertyChanged}"
                                     FontSize="22"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     Foreground="{StaticResource Espresso}"
                                     FontFamily="{StaticResource BrandFont}"/>
                        </Border>
                    </StackPanel>
                </Border>

                </StackPanel> <!-- Close Systems Section -->

                <!-- Sales Section -->
                <StackPanel Visibility="{Binding IsSalesSectionVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <ContentControl>
                        <ContentControl.Content>
                            <local:SalesContentView DataContext="{Binding SalesViewModel}"/>
                        </ContentControl.Content>
                    </ContentControl>
                </StackPanel> <!-- Close Sales Section -->

                <!-- Break Time Section -->
                <StackPanel Visibility="{Binding IsBreakTimeSectionVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Border Background="White"
                        CornerRadius="8"
                        Padding="30"
                        Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="â˜• Break Time Configuration"
                                   FontSize="28"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource DarkBrown}"
                                   Margin="0,0,0,20"/>

                        <!-- Instant Break (Manual Override) -->
                        <Border Background="{StaticResource MetallicGold}"
                                BorderBrush="{StaticResource Espresso}"
                                BorderThickness="3"
                                CornerRadius="12"
                                Padding="25"
                                Margin="0,0,0,25">
                            <StackPanel>
                                <TextBlock Text="âš¡ INSTANT BREAK MODE"
                                           FontSize="26"
                                           FontWeight="Bold"
                                           Foreground="{StaticResource Espresso}"
                                           HorizontalAlignment="Center"
                                           Margin="0,0,0,15"/>

                                <TextBlock Text="Toggle break mode ON/OFF immediately, regardless of scheduled time"
                                           FontSize="18"
                                           Foreground="{StaticResource DarkBrown}"
                                           TextWrapping="Wrap"
                                           TextAlignment="Center"
                                           Margin="0,0,0,15"/>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <CheckBox Grid.Column="0"
                                              IsChecked="{Binding IsInstantBreakActive}"
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Center"
                                              Cursor="Hand">
                                        <CheckBox.LayoutTransform>
                                            <ScaleTransform ScaleX="3" ScaleY="3"/>
                                        </CheckBox.LayoutTransform>
                                    </CheckBox>

                                    <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="30,0,0,0">
                                        <TextBlock FontSize="32"
                                                   FontWeight="Bold"
                                                   Foreground="{StaticResource Espresso}">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Text" Value="OFF"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsInstantBreakActive}" Value="True">
                                                            <Setter Property="Text" Value="ON"/>
                                                            <Setter Property="Foreground" Value="{StaticResource ForestGreen}"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Enable/Disable Scheduled Break Time -->
                        <Border Background="{StaticResource BackgroundBeige}"
                                BorderBrush="{StaticResource SageGreen}"
                                BorderThickness="2"
                                CornerRadius="8"
                                Padding="20"
                                Margin="0,0,0,20">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <CheckBox Grid.Column="0"
                                          IsChecked="{Binding IsBreakTimeEnabled}"
                                          VerticalAlignment="Center"
                                          Margin="0,0,20,0"
                                          Cursor="Hand">
                                    <CheckBox.LayoutTransform>
                                        <ScaleTransform ScaleX="2" ScaleY="2"/>
                                    </CheckBox.LayoutTransform>
                                </CheckBox>

                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="Enable Scheduled Break Time"
                                               FontSize="24"
                                               FontWeight="SemiBold"
                                               Foreground="{StaticResource Espresso}"
                                               Margin="0,0,0,5"/>
                                    <TextBlock Text="When enabled, kiosk will automatically show break screen during configured hours"
                                               FontSize="18"
                                               Foreground="{StaticResource ForestGreen}"
                                               TextWrapping="Wrap"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Break Time Schedule -->
                        <Border Background="{StaticResource Latte}"
                                BorderBrush="{StaticResource MetallicGold}"
                                BorderThickness="2"
                                CornerRadius="8"
                                Padding="25"
                                Margin="0,0,0,20"
                                IsEnabled="{Binding IsBreakTimeEnabled}">
                            <StackPanel>
                                <TextBlock Text="Break Schedule"
                                           FontSize="24"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource DarkBrown}"
                                           Margin="0,0,0,15"/>

                                <!-- Break Start Time -->
                                <Grid Margin="0,0,0,15">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="180"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0"
                                               Text="Start Time:"
                                               FontSize="22"
                                               VerticalAlignment="Center"
                                               Foreground="{StaticResource Espresso}"/>

                                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                                        <!-- Hour -->
                                        <Border Background="White"
                                                BorderBrush="{StaticResource DarkBrown}"
                                                BorderThickness="2"
                                                CornerRadius="8"
                                                Padding="15,10"
                                                Margin="0,0,10,0">
                                            <StackPanel>
                                                <TextBlock Text="Hour (0-23)"
                                                           FontSize="16"
                                                           Foreground="{StaticResource ForestGreen}"
                                                           HorizontalAlignment="Center"
                                                           Margin="0,0,0,5"/>
                                                <TextBox Text="{Binding BreakStartHour, UpdateSourceTrigger=PropertyChanged}"
                                                         FontSize="28"
                                                         FontWeight="Bold"
                                                         Width="100"
                                                         TextAlignment="Center"
                                                         BorderThickness="0"
                                                         Background="Transparent"/>
                                            </StackPanel>
                                        </Border>

                                        <TextBlock Text=":"
                                                   FontSize="36"
                                                   FontWeight="Bold"
                                                   VerticalAlignment="Center"
                                                   Margin="10,0"/>

                                        <!-- Minute -->
                                        <Border Background="White"
                                                BorderBrush="{StaticResource DarkBrown}"
                                                BorderThickness="2"
                                                CornerRadius="8"
                                                Padding="15,10"
                                                Margin="10,0,0,0">
                                            <StackPanel>
                                                <TextBlock Text="Minute (0-59)"
                                                           FontSize="16"
                                                           Foreground="{StaticResource ForestGreen}"
                                                           HorizontalAlignment="Center"
                                                           Margin="0,0,0,5"/>
                                                <TextBox Text="{Binding BreakStartMinute, UpdateSourceTrigger=PropertyChanged}"
                                                         FontSize="28"
                                                         FontWeight="Bold"
                                                         Width="100"
                                                         TextAlignment="Center"
                                                         BorderThickness="0"
                                                         Background="Transparent"/>
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>
                                </Grid>

                                <!-- Break End Time -->
                                <Grid Margin="0,0,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="180"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0"
                                               Text="End Time:"
                                               FontSize="22"
                                               VerticalAlignment="Center"
                                               Foreground="{StaticResource Espresso}"/>

                                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                                        <!-- Hour -->
                                        <Border Background="White"
                                                BorderBrush="{StaticResource DarkBrown}"
                                                BorderThickness="2"
                                                CornerRadius="8"
                                                Padding="15,10"
                                                Margin="0,0,10,0">
                                            <StackPanel>
                                                <TextBlock Text="Hour (0-23)"
                                                           FontSize="16"
                                                           Foreground="{StaticResource ForestGreen}"
                                                           HorizontalAlignment="Center"
                                                           Margin="0,0,0,5"/>
                                                <TextBox Text="{Binding BreakEndHour, UpdateSourceTrigger=PropertyChanged}"
                                                         FontSize="28"
                                                         FontWeight="Bold"
                                                         Width="100"
                                                         TextAlignment="Center"
                                                         BorderThickness="0"
                                                         Background="Transparent"/>
                                            </StackPanel>
                                        </Border>

                                        <TextBlock Text=":"
                                                   FontSize="36"
                                                   FontWeight="Bold"
                                                   VerticalAlignment="Center"
                                                   Margin="10,0"/>

                                        <!-- Minute -->
                                        <Border Background="White"
                                                BorderBrush="{StaticResource DarkBrown}"
                                                BorderThickness="2"
                                                CornerRadius="8"
                                                Padding="15,10"
                                                Margin="10,0,0,0">
                                            <StackPanel>
                                                <TextBlock Text="Minute (0-59)"
                                                           FontSize="16"
                                                           Foreground="{StaticResource ForestGreen}"
                                                           HorizontalAlignment="Center"
                                                           Margin="0,0,0,5"/>
                                                <TextBox Text="{Binding BreakEndMinute, UpdateSourceTrigger=PropertyChanged}"
                                                         FontSize="28"
                                                         FontWeight="Bold"
                                                         Width="100"
                                                         TextAlignment="Center"
                                                         BorderThickness="0"
                                                         Background="Transparent"/>
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Custom Break Message -->
                        <Border Background="{StaticResource BackgroundBeige}"
                                BorderBrush="{StaticResource SageGreen}"
                                BorderThickness="2"
                                CornerRadius="8"
                                Padding="20"
                                Margin="0,0,0,0"
                                IsEnabled="{Binding IsBreakTimeEnabled}">
                            <StackPanel>
                                <TextBlock Text="Custom Message (Optional)"
                                           FontSize="22"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource Espresso}"
                                           Margin="0,0,0,10"/>

                                <TextBlock Text="Leave empty to show default break message"
                                           FontSize="18"
                                           Foreground="{StaticResource ForestGreen}"
                                           Margin="0,0,0,10"/>

                                <TextBox Text="{Binding BreakMessage, UpdateSourceTrigger=PropertyChanged}"
                                         FontSize="20"
                                         TextWrapping="Wrap"
                                         AcceptsReturn="True"
                                         Height="120"
                                         VerticalScrollBarVisibility="Auto"
                                         Padding="10"
                                         BorderBrush="{StaticResource DarkBrown}"
                                         BorderThickness="2"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>
                </StackPanel> <!-- Close Break Time Section -->

                <!-- Payment Section -->
                <StackPanel Visibility="{Binding IsPaymentSectionVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Border Background="White"
                        CornerRadius="8"
                        Padding="30"
                        Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="ðŸ’³ Forte Payment Gateway Configuration"
                                   FontSize="28"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource DarkBrown}"
                                   Margin="0,0,0,20"/>

                        <!-- Enable Payment Toggle -->
                        <Border Background="{StaticResource MetallicGold}"
                                BorderBrush="{StaticResource Espresso}"
                                BorderThickness="3"
                                CornerRadius="8"
                                Padding="20"
                                Margin="0,0,0,20">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <CheckBox Grid.Column="0"
                                          IsChecked="{Binding PaymentEnabled}"
                                          VerticalAlignment="Center"
                                          Margin="0,0,20,0"
                                          Cursor="Hand">
                                    <CheckBox.LayoutTransform>
                                        <ScaleTransform ScaleX="2.5" ScaleY="2.5"/>
                                    </CheckBox.LayoutTransform>
                                </CheckBox>

                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="Enable Payment Processing"
                                               FontSize="26"
                                               FontWeight="Bold"
                                               Foreground="{StaticResource Espresso}"
                                               Margin="0,0,0,5"/>
                                    <TextBlock Text="When disabled, orders will be processed without payment (for testing only)"
                                               FontSize="18"
                                               Foreground="{StaticResource DarkBrown}"
                                               TextWrapping="Wrap"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Sandbox Mode Toggle -->
                        <Border Background="{StaticResource Latte}"
                                BorderBrush="{StaticResource MetallicGold}"
                                BorderThickness="2"
                                CornerRadius="8"
                                Padding="20"
                                Margin="0,0,0,20"
                                IsEnabled="{Binding PaymentEnabled}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <CheckBox Grid.Column="0"
                                          IsChecked="{Binding ForteSandboxMode}"
                                          VerticalAlignment="Center"
                                          Margin="0,0,20,0"
                                          Cursor="Hand">
                                    <CheckBox.LayoutTransform>
                                        <ScaleTransform ScaleX="2" ScaleY="2"/>
                                    </CheckBox.LayoutTransform>
                                </CheckBox>

                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="Sandbox Mode (Test Environment)"
                                               FontSize="24"
                                               FontWeight="SemiBold"
                                               Foreground="{StaticResource Espresso}"
                                               Margin="0,0,0,5"/>
                                    <TextBlock Text="Enable for testing. Disable for live transactions."
                                               FontSize="18"
                                               Foreground="{StaticResource ForestGreen}"
                                               TextWrapping="Wrap"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- API Credentials -->
                        <Border Background="{StaticResource BackgroundBeige}"
                                BorderBrush="{StaticResource SageGreen}"
                                BorderThickness="2"
                                CornerRadius="8"
                                Padding="20"
                                Margin="0,0,0,20"
                                IsEnabled="{Binding PaymentEnabled}">
                            <StackPanel>
                                <TextBlock Text="API Credentials"
                                           FontSize="22"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource Espresso}"
                                           Margin="0,0,0,15"/>

                                <!-- API Access ID -->
                                <TextBlock Text="API Access ID:"
                                           FontSize="20"
                                           Foreground="{StaticResource DarkBrown}"
                                           Margin="0,0,0,8"/>
                                <TextBox Text="{Binding ForteApiAccessId, UpdateSourceTrigger=PropertyChanged}"
                                         FontSize="20"
                                         Padding="12"
                                         BorderBrush="{StaticResource DarkBrown}"
                                         BorderThickness="2"
                                         Margin="0,0,0,15"/>

                                <!-- API Secure Key -->
                                <TextBlock Text="API Secure Key:"
                                           FontSize="20"
                                           Foreground="{StaticResource DarkBrown}"
                                           Margin="0,0,0,8"/>
                                <PasswordBox x:Name="ForteApiSecureKeyBox"
                                             FontSize="20"
                                             Padding="12"
                                             BorderBrush="{StaticResource DarkBrown}"
                                             BorderThickness="2"
                                             Margin="0,0,0,5"
                                             PasswordChanged="ForteSecureKey_PasswordChanged"/>
                                <TextBlock Text="Leave blank to keep existing key"
                                           FontSize="16"
                                           Foreground="{StaticResource ForestGreen}"
                                           FontStyle="Italic"
                                           Margin="0,0,0,15"/>
                            </StackPanel>
                        </Border>

                        <!-- Organization and Location IDs -->
                        <Border Background="{StaticResource BackgroundBeige}"
                                BorderBrush="{StaticResource SageGreen}"
                                BorderThickness="2"
                                CornerRadius="8"
                                Padding="20"
                                Margin="0,0,0,20"
                                IsEnabled="{Binding PaymentEnabled}">
                            <StackPanel>
                                <TextBlock Text="Organization &amp; Location"
                                           FontSize="22"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource Espresso}"
                                           Margin="0,0,0,15"/>

                                <!-- Organization ID -->
                                <TextBlock Text="Organization ID (e.g., org_300005):"
                                           FontSize="20"
                                           Foreground="{StaticResource DarkBrown}"
                                           Margin="0,0,0,8"/>
                                <TextBox Text="{Binding ForteOrganizationId, UpdateSourceTrigger=PropertyChanged}"
                                         FontSize="20"
                                         Padding="12"
                                         BorderBrush="{StaticResource DarkBrown}"
                                         BorderThickness="2"
                                         Margin="0,0,0,15"/>

                                <!-- Location ID -->
                                <TextBlock Text="Location ID (e.g., loc_192834):"
                                           FontSize="20"
                                           Foreground="{StaticResource DarkBrown}"
                                           Margin="0,0,0,8"/>
                                <TextBox Text="{Binding ForteLocationId, UpdateSourceTrigger=PropertyChanged}"
                                         FontSize="20"
                                         Padding="12"
                                         BorderBrush="{StaticResource DarkBrown}"
                                         BorderThickness="2"
                                         Margin="0,0,0,5"/>
                            </StackPanel>
                        </Border>

                        <!-- Info Box -->
                        <Border Background="{StaticResource MetallicGold}"
                                BorderBrush="{StaticResource Espresso}"
                                BorderThickness="2"
                                CornerRadius="8"
                                Padding="20"
                                Margin="0,0,0,20">
                            <StackPanel>
                                <TextBlock Text="â„¹ï¸ How to get your credentials:"
                                           FontSize="20"
                                           FontWeight="Bold"
                                           Foreground="{StaticResource DarkBrown}"
                                           Margin="0,0,0,10"/>
                                <TextBlock TextWrapping="Wrap"
                                           FontSize="18"
                                           Foreground="{StaticResource Espresso}"
                                           LineHeight="26">
                                    <Run Text="1. Log in to Forte Dex portal"/>
                                    <LineBreak/>
                                    <Run Text="2. For Organization ID: Click profile icon â†’ Organization"/>
                                    <LineBreak/>
                                    <Run Text="3. For Location ID: Click Location from menu"/>
                                    <LineBreak/>
                                    <Run Text="4. For API Credentials: Developer â†’ API Credentials â†’ Create"/>
                                    <LineBreak/>
                                    <LineBreak/>
                                    <Run Text="Current credentials:" FontWeight="Bold"/>
                                    <LineBreak/>
                                    <Run Text="API Access ID: 03a04fee3e438b44ef168052227cf9ac"/>
                                    <LineBreak/>
                                    <Run Text="API Secure Key: c24eadad0838c40a8bb469c67d71eceb"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>

                        <!-- Payment Test Section -->
                        <Border Background="{StaticResource AccentLatte}"
                                BorderBrush="{StaticResource AccentGold}"
                                BorderThickness="3"
                                CornerRadius="8"
                                Padding="30"
                                IsEnabled="{Binding PaymentEnabled}">
                            <StackPanel>
                                <TextBlock Text="ðŸ§ª Test Payment Integration"
                                           FontSize="24"
                                           FontWeight="Bold"
                                           Foreground="{StaticResource DarkBrown}"
                                           Margin="0,0,0,15"/>

                                <TextBlock Text="Click the button below to verify that your Forte payment credentials are working correctly."
                                           FontSize="18"
                                           Foreground="{StaticResource Espresso}"
                                           TextWrapping="Wrap"
                                           Margin="0,0,0,20"/>

                                <Button Command="{Binding TestPaymentCommand}"
                                        Background="{StaticResource ForestGreen}"
                                        BorderBrush="{StaticResource DarkBrown}"
                                        BorderThickness="2"
                                        Padding="30,15"
                                        Cursor="Hand"
                                        Margin="0,0,0,20">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="{TemplateBinding Background}"
                                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                                CornerRadius="8"
                                                                Padding="{TemplateBinding Padding}">
                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        </Border>
                                                        <ControlTemplate.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter Property="Background" Value="{StaticResource SageGreen}"/>
                                                            </Trigger>
                                                            <Trigger Property="IsPressed" Value="True">
                                                                <Setter Property="Background" Value="{StaticResource DarkBrown}"/>
                                                            </Trigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </Button.Style>
                                    <TextBlock FontSize="22"
                                               FontWeight="Bold"
                                               Foreground="White">
                                        <Run Text="ðŸ” Test Payment Connection"/>
                                    </TextBlock>
                                </Button>

                                <!-- Test Status Message -->
                                <Border Visibility="{Binding HasPaymentTestStatus, Converter={StaticResource BooleanToVisibilityConverter}}"
                                        Padding="20"
                                        CornerRadius="8"
                                        Margin="0,0,0,0">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="{StaticResource LightCream}"/>
                                            <Setter Property="BorderBrush" Value="#E74C3C"/>
                                            <Setter Property="BorderThickness" Value="2"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsPaymentTestSuccess}" Value="True">
                                                    <Setter Property="Background" Value="#D4EDDA"/>
                                                    <Setter Property="BorderBrush" Value="#28A745"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBlock Text="{Binding PaymentTestStatus}"
                                               FontSize="18"
                                               FontWeight="SemiBold"
                                               TextWrapping="Wrap">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Foreground" Value="#C0392B"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsPaymentTestSuccess}" Value="True">
                                                        <Setter Property="Foreground" Value="#155724"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Border>

                                <!-- Loading Indicator -->
                                <Border Visibility="{Binding IsTestingPayment, Converter={StaticResource BooleanToVisibilityConverter}}"
                                        Background="{StaticResource BackgroundBeige}"
                                        BorderBrush="{StaticResource MetallicGold}"
                                        BorderThickness="2"
                                        Padding="20"
                                        CornerRadius="8"
                                        Margin="0,10,0,0">
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <TextBlock Text="â³"
                                                   FontSize="24"
                                                   Margin="0,0,10,0"/>
                                        <TextBlock Text="Testing payment integration..."
                                                   FontSize="20"
                                                   FontWeight="SemiBold"
                                                   Foreground="{StaticResource DarkBrown}"/>
                                    </StackPanel>
                                </Border>

                                <!-- Detailed Logs Display -->
                                <Border Background="#F8F9FA"
                                        BorderBrush="{StaticResource DarkBrown}"
                                        BorderThickness="2"
                                        CornerRadius="8"
                                        Padding="0"
                                        Margin="0,20,0,0">
                                    <StackPanel>
                                        <Border Background="{StaticResource Espresso}"
                                                Padding="15,10"
                                                CornerRadius="8,8,0,0">
                                            <TextBlock Text="ðŸ“‹ Detailed Test Logs"
                                                       FontSize="20"
                                                       FontWeight="Bold"
                                                       Foreground="White"/>
                                        </Border>

                                        <ScrollViewer Height="400"
                                                      VerticalScrollBarVisibility="Auto"
                                                      Padding="15">
                                            <ItemsControl ItemsSource="{Binding PaymentTestLogs}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding}"
                                                                   FontSize="16"
                                                                   FontFamily="Consolas, Courier New, monospace"
                                                                   Foreground="{StaticResource Espresso}"
                                                                   TextWrapping="Wrap"
                                                                   Margin="0,2"/>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </ScrollViewer>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>
                </StackPanel> <!-- Close Payment Section -->

                <!-- Security Section -->
                <StackPanel Visibility="{Binding IsSecuritySectionVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                <!-- Admin PIN Change Section -->
                <Border Background="White"
                        CornerRadius="8"
                        Padding="30"
                        Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="ðŸ”’ Admin PIN"
                                   FontSize="28"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource DarkBrown}"
                                   Margin="0,0,0,20"/>

                        <!-- PIN Fields (tap to select, then use keypad below) -->

                        <!-- Current PIN -->
                        <Border Background="{StaticResource BackgroundBeige}"
                                BorderBrush="{StaticResource DarkBrown}"
                                BorderThickness="2"
                                CornerRadius="8"
                                Padding="15"
                                Margin="0,0,0,15"
                                Cursor="Hand"
                                MouseDown="CurrentPinField_MouseDown">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ElementName=CurrentPinRadio, Path=IsChecked}" Value="True">
                                            <Setter Property="Background" Value="#FFF9E6"/>
                                            <Setter Property="BorderBrush" Value="{StaticResource AccentGold}"/>
                                            <Setter Property="BorderThickness" Value="5"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="200"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <RadioButton x:Name="CurrentPinRadio"
                                           Grid.Column="0"
                                           GroupName="PinFields"
                                           IsChecked="True"
                                           VerticalAlignment="Center"
                                           Margin="0,0,15,0"/>

                                <TextBlock Grid.Column="1"
                                           Text="Current PIN:"
                                           FontSize="20"
                                           VerticalAlignment="Center"
                                           Foreground="{StaticResource DarkBrown}"/>

                                <controls:PinDisplay Grid.Column="2"
                                                    PinLength="{Binding CurrentPassword.Length}"
                                                    MaxDigits="8"
                                                    Height="50"
                                                    VerticalAlignment="Center"/>
                            </Grid>
                        </Border>

                        <!-- New PIN -->
                        <Border Background="{StaticResource BackgroundBeige}"
                                BorderBrush="{StaticResource DarkBrown}"
                                BorderThickness="2"
                                CornerRadius="8"
                                Padding="15"
                                Margin="0,0,0,15"
                                Cursor="Hand"
                                MouseDown="NewPinField_MouseDown">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ElementName=NewPinRadio, Path=IsChecked}" Value="True">
                                            <Setter Property="Background" Value="#FFF9E6"/>
                                            <Setter Property="BorderBrush" Value="{StaticResource AccentGold}"/>
                                            <Setter Property="BorderThickness" Value="5"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="200"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <RadioButton x:Name="NewPinRadio"
                                           Grid.Column="0"
                                           GroupName="PinFields"
                                           VerticalAlignment="Center"
                                           Margin="0,0,15,0"/>

                                <TextBlock Grid.Column="1"
                                           Text="New PIN:"
                                           FontSize="20"
                                           VerticalAlignment="Center"
                                           Foreground="{StaticResource DarkBrown}"/>

                                <controls:PinDisplay Grid.Column="2"
                                                    PinLength="{Binding NewPassword.Length}"
                                                    MaxDigits="8"
                                                    Height="50"
                                                    VerticalAlignment="Center"/>
                            </Grid>
                        </Border>

                        <!-- Confirm PIN -->
                        <Border Background="{StaticResource BackgroundBeige}"
                                BorderBrush="{StaticResource DarkBrown}"
                                BorderThickness="2"
                                CornerRadius="8"
                                Padding="15"
                                Margin="0,0,0,20"
                                Cursor="Hand"
                                MouseDown="ConfirmPinField_MouseDown">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ElementName=ConfirmPinRadio, Path=IsChecked}" Value="True">
                                            <Setter Property="Background" Value="#FFF9E6"/>
                                            <Setter Property="BorderBrush" Value="{StaticResource AccentGold}"/>
                                            <Setter Property="BorderThickness" Value="5"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="200"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <RadioButton x:Name="ConfirmPinRadio"
                                           Grid.Column="0"
                                           GroupName="PinFields"
                                           VerticalAlignment="Center"
                                           Margin="0,0,15,0"/>

                                <TextBlock Grid.Column="1"
                                           Text="Confirm PIN:"
                                           FontSize="20"
                                           VerticalAlignment="Center"
                                           Foreground="{StaticResource DarkBrown}"/>

                                <controls:PinDisplay Grid.Column="2"
                                                    PinLength="{Binding ConfirmPassword.Length}"
                                                    MaxDigits="8"
                                                    Height="50"
                                                    VerticalAlignment="Center"/>
                            </Grid>
                        </Border>

                        <!-- Shared Numeric Keypad -->
                        <TextBlock Text="Tap a PIN field above, then use the keypad:"
                                   FontSize="16"
                                   Foreground="{StaticResource Espresso}"
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,10"/>

                        <controls:NumericKeypad x:Name="PinKeypad"
                                               Height="350"
                                               Margin="0,0,0,20"/>

                        <!-- Password Change Status/Error Message -->
                        <TextBlock Text="{Binding PasswordChangeMessage}"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,15"
                                   Visibility="{Binding HasPasswordChangeMessage, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Foreground" Value="{StaticResource ErrorRed}"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsPasswordChangeSuccess}" Value="True">
                                            <Setter Property="Foreground" Value="{StaticResource AccentGreen}"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- Change PIN Button -->
                        <Button Content="Change PIN"
                                Command="{Binding ChangePasswordCommand}"
                                FontSize="22"
                                Padding="30,10"
                                HorizontalAlignment="Left"
                                Background="{StaticResource AccentGreen}"
                                Foreground="White"
                                BorderBrush="{StaticResource DarkBrown}"
                                BorderThickness="2"
                                Cursor="Hand">
                            <Button.Resources>
                                <Style TargetType="Border">
                                    <Setter Property="CornerRadius" Value="8"/>
                                </Style>
                            </Button.Resources>
                        </Button>
                    </StackPanel>
                </Border>
                </StackPanel> <!-- Close Security Section -->
            </StackPanel> <!-- Close main StackPanel -->
        </ScrollViewer>

        <!-- Action Buttons -->
        <Grid Grid.Row="3"
              Background="{StaticResource DarkBrown}"
              Margin="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0"
                    Content="Cancel"
                    Command="{Binding CancelCommand}"
                    FontSize="32"
                    FontWeight="Bold"
                    Margin="40,20"
                    Background="{StaticResource Espresso}"
                    Foreground="White"
                    BorderBrush="{StaticResource ForestGreen}"
                    BorderThickness="2"
                    Cursor="Hand">
                <Button.Resources>
                    <Style TargetType="Border">
                        <Setter Property="CornerRadius" Value="12"/>
                    </Style>
                </Button.Resources>
            </Button>

            <Button Grid.Column="1"
                    Content="Save / Go Back"
                    Command="{Binding SaveCommand}"
                    FontSize="32"
                    FontWeight="Bold"
                    Margin="40,20"
                    Background="{StaticResource AccentGold}"
                    Foreground="{StaticResource DarkBrown}"
                    BorderBrush="{StaticResource DarkBrown}"
                    BorderThickness="2"
                    Cursor="Hand">
                <Button.Resources>
                    <Style TargetType="Border">
                        <Setter Property="CornerRadius" Value="12"/>
                    </Style>
                </Button.Resources>
            </Button>

            <Button Grid.Column="2"
                    Content="Exit Program"
                    Command="{Binding ExitCommand}"
                    FontSize="32"
                    FontWeight="Bold"
                    Margin="40,20"
                    Background="{StaticResource ErrorRed}"
                    Foreground="White"
                    BorderBrush="{StaticResource ErrorRed}"
                    BorderThickness="2"
                    Cursor="Hand">
                <Button.Resources>
                    <Style TargetType="Border">
                        <Setter Property="CornerRadius" Value="12"/>
                    </Style>
                </Button.Resources>
            </Button>
        </Grid>

        <!-- Hidden WebView2 for payment test validation -->
        <wv2:WebView2 x:Name="PaymentTestWebView"
                      Grid.Row="0"
                      Grid.RowSpan="4"
                      Visibility="Collapsed"
                      Width="0"
                      Height="0"/>
    </Grid>
</UserControl>
